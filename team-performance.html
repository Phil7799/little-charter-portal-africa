<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Performance - Charter & HR Analytics</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo-container">
                <div class="logo">
                    <span class="logo-blue">L</span>
                    <span class="logo-green">I</span>
                    <span class="logo-yellow">T</span>
                    <span class="logo-red">T</span>
                    <span class="logo-blue">L</span>
                    <span class="logo-green">E</span>
                    <span class="logo-yellow"> </span>
                    <span class="logo-red">A</span>
                    <span class="logo-blue">F</span>
                    <span class="logo-green">R</span>
                    <span class="logo-yellow">I</span>
                    <span class="logo-red">C</span>
                    <span class="logo-blue">A</span>
                </div>
                <h1>Team Performance</h1>
            </div>
            <div class="portal-toggle">
                <button id="switchPortal" class="toggle-btn">
                    <i class="fas fa-exchange-alt"></i> Switch to Sales Portal
                </button>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav class="navbar">
            <ul>
                <li><a href="index.html"><i class="fas fa-home"></i> Overview</a></li>
                <li><a href="upload.html"><i class="fas fa-upload"></i> Upload Data</a></li>
                <li><a href="dashboard.html"><i class="fas fa-chart-bar"></i> Analytics Dashboard</a></li>
                <li><a href="team-performance.html" class="active"><i class="fas fa-users"></i> Team Performance</a></li>
                <li><a href="reports.html"><i class="fas fa-file-alt"></i> Reports</a></li>
            </ul>
        </nav>
        
        <!-- Main Content -->
        <main class="main-content">
            <div class="welcome-section">
                <h2><i class="fas fa-users blue-text"></i> Team Performance Analysis</h2>
                <p>Comprehensive performance metrics and comparisons for all team members.</p>
            </div>
            
            <!-- Team Stats -->
            <div class="stats-container">
                <div class="stat-card blue">
                    <h3><i class="fas fa-user-tie"></i> Total Team Members</h3>
                    <div class="stat-value" id="teamCount">2</div>
                    <p>Active Associates</p>
                </div>
                
                <div class="stat-card green">
                    <h3><i class="fas fa-trophy"></i> Top Performer</h3>
                    <div class="stat-value" id="topPerformer" style="font-size: 1.5rem;">Carol Ngugi</div>
                    <p>Based on 2026 Revenue</p>
                </div>
                
                <div class="stat-card yellow">
                    <h3><i class="fas fa-chart-line"></i> Avg Achievement</h3>
                    <div class="stat-value" id="avgAchievement">10.5%</div>
                    <p>Against 2026 Targets</p>
                </div>
                
                <div class="stat-card red">
                    <h3><i class="fas fa-bullseye"></i> Team Target</h3>
                    <div class="stat-value" id="teamTarget">Ksh 118.9M</div>
                    <p>2026 Charter Target</p>
                </div>
            </div>
            
            <!-- Performance Comparison Charts -->
            <div class="charts-container">
                <div class="chart-card">
                    <h3><i class="fas fa-chart-bar blue-text"></i> Individual Revenue Performance</h3>
                    <div class="chart-container">
                        <canvas id="individualPerformanceChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3><i class="fas fa-percentage green-text"></i> Target Achievement by Associate</h3>
                    <div class="chart-container">
                        <canvas id="achievementComparisonChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3><i class="fas fa-calendar-alt yellow-text"></i> Monthly Performance Trends</h3>
                    <div class="chart-container">
                        <canvas id="monthlyTrendsChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3><i class="fas fa-balance-scale red-text"></i> Revenue Share Distribution</h3>
                    <div class="chart-container">
                        <canvas id="revenueShareChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Individual Performance Cards -->
            <div class="welcome-section">
                <h3><i class="fas fa-user-friends blue-text"></i> Individual Performance Details</h3>
                <div id="individualCards" class="action-cards" style="margin-top: 20px;">
                    <!-- Cards will be populated by JavaScript -->
                </div>
            </div>
            
        </main>
        
        <!-- Footer -->
        <footer class="footer">
            <p>Little Africa Charter & HR Analytics Portal &copy; 2025</p>
            <p>Team performance metrics updated automatically with data uploads.</p>
        </footer>
    </div>
    
    <script src="data-parser.js"></script>
    <script src="script.js"></script>
    <script>
        // Team Performance specific initialization
        document.addEventListener('DOMContentLoaded', function() {
            const hasData = dataParser.loadFromLocalStorage();
            if (hasData) {
                updateTeamPerformance();
            }
        });
        
        function updateTeamPerformance() {
            const data = dataParser.processedData;
            if (!data || !data.charter || !data.charter.byAssociate) {
                console.log('No data available');
                return;
            }
            
            const associates = Object.keys(data.charter.byAssociate);
            
            // Update team stats
            document.getElementById('teamCount').textContent = associates.length;
            
            // Find top performer
            let topPerformer = '';
            let maxRevenue = 0;
            associates.forEach(associate => {
                const revenue = data.charter.byAssociate[associate].total2026 || 0;
                if (revenue > maxRevenue) {
                    maxRevenue = revenue;
                    topPerformer = associate;
                }
            });
            
            if (topPerformer) {
                document.getElementById('topPerformer').textContent = topPerformer.split('@')[0];
            }
            
            // Calculate average achievement
            let totalAchievement = 0;
            associates.forEach(associate => {
                const assocData = data.charter.byAssociate[associate];
                const achievement = assocData.target2026 > 0 ? (assocData.total2026 / assocData.target2026) * 100 : 0;
                totalAchievement += achievement;
            });
            const avgAchievement = associates.length > 0 ? totalAchievement / associates.length : 0;
            document.getElementById('avgAchievement').textContent = avgAchievement.toFixed(1) + '%';
            
            // Update team target
            const teamTarget = data.charter.totals?.target2026 || 0;
            document.getElementById('teamTarget').textContent = 'Ksh ' + (teamTarget / 1000000).toFixed(1) + 'M';
            
            // Create individual performance cards
            const cardsContainer = document.getElementById('individualCards');
            cardsContainer.innerHTML = '';
            
            associates.forEach((associate, index) => {
                const assocData = data.charter.byAssociate[associate];
                const achievement = assocData.target2026 > 0 ? (assocData.total2026 / assocData.target2026) * 100 : 0;
                const colors = ['blue', 'green', 'yellow', 'red'];
                const color = colors[index % colors.length];
                
                const card = document.createElement('div');
                card.className = 'action-card';
                card.innerHTML = `
                    <div class="action-icon ${color}">
                        <i class="fas fa-user"></i>
                    </div>
                    <h3>${associate.split('@')[0]}</h3>
                    <p><strong>2026 Revenue:</strong> Ksh ${dataParser.formatNumber(assocData.total2026)}</p>
                    <p><strong>Target:</strong> Ksh ${dataParser.formatNumber(assocData.target2026)}</p>
                    <p><strong>Achievement:</strong> <span class="${achievement >= 100 ? 'positive' : 'negative'}" style="font-weight: bold;">${achievement.toFixed(1)}%</span></p>
                    <p><strong>YoY Growth:</strong> ${assocData.total2025 > 0 ? (((assocData.total2026 - assocData.total2025) / assocData.total2025) * 100).toFixed(1) : 0}%</p>
                `;
                cardsContainer.appendChild(card);
            });
            
            // Update charts
            updateTeamCharts();
        }
        
        function updateTeamCharts() {
            const data = dataParser.processedData;
            const associates = Object.keys(data.charter.byAssociate);
            
            // Individual Performance Chart
            const ctx1 = document.getElementById('individualPerformanceChart');
            if (ctx1) {
                new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: associates.map(a => a.split('@')[0]),
                        datasets: [{
                            label: '2025 Revenue (Millions)',
                            data: associates.map(a => data.charter.byAssociate[a].total2025 / 1000000),
                            backgroundColor: 'rgba(26, 115, 232, 0.7)'
                        }, {
                            label: '2026 Revenue (Millions)',
                            data: associates.map(a => data.charter.byAssociate[a].total2026 / 1000000),
                            backgroundColor: 'rgba(52, 168, 83, 0.7)'
                        }, {
                            label: '2026 Target (Millions)',
                            data: associates.map(a => data.charter.byAssociate[a].target2026 / 1000000),
                            backgroundColor: 'rgba(251, 188, 4, 0.7)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Revenue (Ksh Millions)' }
                            }
                        }
                    }
                });
            }
            
            // Achievement Comparison Chart
            const ctx2 = document.getElementById('achievementComparisonChart');
            if (ctx2) {
                const achievements = associates.map(a => {
                    const assocData = data.charter.byAssociate[a];
                    return assocData.target2026 > 0 ? (assocData.total2026 / assocData.target2026) * 100 : 0;
                });
                
                new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: associates.map(a => a.split('@')[0]),
                        datasets: [{
                            label: 'Achievement %',
                            data: achievements,
                            backgroundColor: achievements.map(a => a >= 100 ? 'rgba(52, 168, 83, 0.7)' : 'rgba(234, 67, 53, 0.7)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Achievement %' },
                                ticks: { callback: value => value + '%' }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: context => 'Achievement: ' + context.parsed.y.toFixed(1) + '%'
                                }
                            }
                        }
                    }
                });
            }
            
            // Monthly Trends Chart
            const ctx3 = document.getElementById('monthlyTrendsChart');
            if (ctx3) {
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const fullMonths = data.summary?.months || [];
                const colors = ['rgba(26, 115, 232, 0.7)', 'rgba(52, 168, 83, 0.7)', 'rgba(251, 188, 4, 0.7)', 'rgba(234, 67, 53, 0.7)'];
                
                const datasets = associates.map((associate, index) => {
                    const monthlyData = fullMonths.map(month => {
                        const monthData = data.charter.byAssociate[associate]?.months?.[month];
                        return monthData ? monthData.total2026 / 1000000 : 0;
                    });
                    
                    return {
                        label: associate.split('@')[0],
                        data: monthlyData,
                        borderColor: colors[index % colors.length],
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        tension: 0.3
                    };
                });
                
                new Chart(ctx3, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Revenue (Ksh Millions)' }
                            }
                        }
                    }
                });
            }
            
            // Revenue Share Chart
            const ctx4 = document.getElementById('revenueShareChart');
            if (ctx4) {
                const revenues = associates.map(a => data.charter.byAssociate[a].total2026);
                
                new Chart(ctx4, {
                    type: 'pie',
                    data: {
                        labels: associates.map(a => a.split('@')[0]),
                        datasets: [{
                            data: revenues,
                            backgroundColor: ['rgba(26, 115, 232, 0.8)', 'rgba(52, 168, 83, 0.8)', 'rgba(251, 188, 4, 0.8)', 'rgba(234, 67, 53, 0.8)']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: context => {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = total > 0 ? ((context.raw / total) * 100).toFixed(1) : 0;
                                        return `${context.label}: ${percentage}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>